# LCM service configuration
data_dir: /app/data
default_validity_days: 365
auto_approve_certificates: true  # Set to true for automatic approval (like Puppet auto-signing)
auto_generate_ca: true  # Automatically generate self-signed CA if not exists
shared_secret: "changeme"  # Global shared secret for certificate requests
ca_cert_path: "/app/data/ca/ca.crt"  # Path to CA certificate
ca_key_path: "/app/data/ca/ca.key"   # Path to CA private key
module_registration_secret: "change-me-in-production"  # Secret for module self-service certificate bootstrap (NOT shared_secret)

# Config-driven module certificate generation (replaces hardcoded per-module functions)
bootstrap_modules:
  - module_id: deployer
    client_id: lcm-deployer
    cert_dir: deployer
    server_cert_dir: deployer-server
    display_name: LCM Deployer
    dns_names: [deployer-service, deployer, localhost, deployer.local]
  - module_id: warden
    client_id: lcm-warden
    cert_dir: warden
    server_cert_dir: warden-server
    display_name: LCM Warden
    dns_names: [warden-service, warden, localhost, warden.local]
  - module_id: ipam
    client_id: lcm-ipam
    cert_dir: ipam
    server_cert_dir: ipam-server
    display_name: LCM IPAM
    dns_names: [ipam-service, ipam, localhost, ipam.local]
  - module_id: paperless
    client_id: lcm-paperless
    cert_dir: paperless
    server_cert_dir: paperless-server
    display_name: LCM Paperless
    dns_names: [paperless-service, paperless, localhost, paperless.local]
  - module_id: sharing
    client_id: lcm-sharing
    cert_dir: sharing
    server_cert_dir: sharing-server
    display_name: LCM Sharing
    dns_names: [sharing-service, sharing, localhost, sharing.local]
  - module_id: bookmark
    client_id: lcm-bookmark
    cert_dir: bookmark
    server_cert_dir: bookmark-server
    display_name: LCM Bookmark
    dns_names: [bookmark-service, bookmark, localhost, bookmark.local]
  - module_id: executor
    client_id: lcm-executor
    cert_dir: executor
    server_cert_dir: executor-server
    display_name: LCM Executor
    dns_names: [executor-service, executor, localhost, executor.local]
  - module_id: asset
    client_id: lcm-asset
    cert_dir: asset
    server_cert_dir: asset-server
    display_name: LCM Asset
    dns_names: [asset-service, asset, localhost, asset.local]
  - module_id: backup
    client_id: lcm-backup
    cert_dir: backup
    server_cert_dir: backup-server
    display_name: LCM Backup
    dns_names: [backup-service, backup, localhost, backup.local]

# Event notification configuration (Redis pub/sub)
events:
  enabled: true
  topic_prefix: "lcm"

# Webhook notification configuration
webhooks:
  enabled: false  # Set to true to enable webhooks
  timeout_seconds: 30
  worker_count: 2
  retry:
    max_attempts: 3
    initial_delay_ms: 1000
    max_delay_ms: 60000
    backoff_multiplier: 2.0

# Frontend ACME certificate configuration (Let's Encrypt via DNS-01)
frontend_certificate:
  enabled: true
  domain: "portal.infra.verax.net"
  acme_endpoint: "https://acme-v02.api.letsencrypt.org/directory"
  acme_email: "admin@verax.net"
  dns_provider: "gcloud"
  dns_provider_config:
    project: "PROJECT-ID"
    serviceAccountFile: "/app/configs/gcp-dns-sa.json"
    dnsPropagationTimeout: "120"
    dnsTTL: "300"
  key_type: "ec"
  key_size: 256
  output_dir: "frontend"
  renew_before_days: 30
  dns_resolvers:
    - "1.1.1.1:53"
    - "8.8.8.8:53"
